<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript">
  function getAudioFile(audioCtx, url) {
    source = audioCtx.createBufferSource();
    var request = new XMLHttpRequest();

    request.open('GET', url, true);

    request.responseType = 'arraybuffer';

    request.onload = function() {
      var audioData = request.response;

      audioCtx.decodeAudioData(audioData, function(buffer) {
          source.buffer = buffer;

          //source.connect(audioCtx.destination);
          //source.loop = true;
        },

        function(e){ console.log("Error with decoding audio data" + e.err); });

    }

    request.send();
    return source;
  }

  window.onload = function(){
    const url = "music/surf_mesa_ily.mp3";
    var audio = new Audio();
    audio.src = url;
    audio.controls = true;
    audio.loop = false;
    audio.autoplay = false;
    audio.muted = false;
    document.getElementById("audio").appendChild(audio);

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioContext = new AudioContext();
    const track = getAudioFile(audioContext, url);
    /*const analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;

    track.connect(analyser);
    analyser.connect(audioContext.destination);
    */
  }
  </script>
</head>
<body>
<div id="audio"></div>
</body>
</html>
